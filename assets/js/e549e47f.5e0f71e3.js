"use strict";(globalThis.webpackChunkportfolio=globalThis.webpackChunkportfolio||[]).push([[164],{1026:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>l,frontMatter:()=>o,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"general/AD","title":"AD","description":"Active Directory (AD) is a service that allow admins to manage collections of machines at the same time. Each domain is managed by a central machine known as the domain controller (DC).","source":"@site/docs/general/AD.md","sourceDirName":"general","slug":"/general/AD","permalink":"/portfolio/docs/general/AD","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1762682716000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"General","permalink":"/portfolio/docs/category/general"},"next":{"title":"Connecting","permalink":"/portfolio/docs/general/Connecting"}}');var t=r(4848),i=r(8453);const o={},c="Core concepts",a={},d=[{value:"LDAP",id:"ldap",level:2},{value:"Distinguished Name",id:"distinguished-name",level:2},{value:"NTLM Auth Steps",id:"ntlm-auth-steps",level:2},{value:"Kerberos Auth Steps",id:"kerberos-auth-steps",level:2},{value:"AD permissions",id:"ad-permissions",level:2},{value:"AS-REP Roasting",id:"as-rep-roasting",level:2}];function h(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,i.R)(),...e.components},{Details:n}=s;return n||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"Active Directory (AD) is a service that allow admins to manage collections of machines at the same time. Each domain is managed by a central machine known as the domain controller (DC)."}),"\n",(0,t.jsxs)(s.p,{children:["with sufficient perms, u can just change another user\u2019s pw using ",(0,t.jsx)(s.code,{children:"net user <user> <new pw> /domain"})]}),"\n",(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"core-concepts",children:"Core concepts"})}),"\n",(0,t.jsxs)(n,{children:[(0,t.jsx)(s.p,{children:"powerful groups: Domain Admins, Enterprise Admins"}),(0,t.jsx)(s.h2,{id:"ldap",children:"LDAP"}),(0,t.jsxs)(n,{children:[(0,t.jsx)(s.p,{children:"When we query user or group objects, LDAP is used as the communication channel for the query."}),(0,t.jsx)(s.p,{children:(0,t.jsx)(s.code,{children:"LDAP://HostName[:PortNumber][/DistinguishedName]"})}),(0,t.jsx)(s.p,{children:"Hostname: hostname(computer name / IP / domain name) of DC holding the\xa0PdcRoleOwner\xa0property"}),(0,t.jsx)(s.p,{children:"(optional) Port: for DC using non-default ports"}),(0,t.jsxs)(s.p,{children:["(optional) Distinguished Name: ",(0,t.jsx)(s.a,{href:"/docs/general/AD#distinguished-name",children:"here"})]})]}),(0,t.jsx)(s.h2,{id:"distinguished-name",children:"Distinguished Name"}),(0,t.jsx)(n,{children:(0,t.jsxs)(s.p,{children:["Every object has a DN, leftmost is highest hierarchy (like parent or smth) and rightmost is lowest hierarchy. Eg, ",(0,t.jsx)(s.code,{children:"CN=Stephanie,CN=Users,DC=corp,DC=com"})," is a DN for the user Stephanie, as u can see the hierarchy goes from left to right"]})}),(0,t.jsx)(s.h2,{id:"ntlm-auth-steps",children:"NTLM Auth Steps"}),(0,t.jsx)(n,{children:(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"NTLM Auth Steps",src:r(2682).A+"",width:"944",height:"839"})})}),(0,t.jsx)(s.h2,{id:"kerberos-auth-steps",children:"Kerberos Auth Steps"}),(0,t.jsx)(n,{children:(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Kerberos Auth Steps",src:r(3702).A+"",width:"942",height:"836"})})}),(0,t.jsx)(s.h2,{id:"ad-permissions",children:"AD permissions"}),(0,t.jsxs)(n,{children:[(0,t.jsx)(s.p,{children:"[Highest] GenericAll: Full permissions on object"}),(0,t.jsx)(s.p,{children:"GenericWrite: Edit certain attributes on the object"}),(0,t.jsx)(s.p,{children:"WriteOwner: Change ownership of the object"}),(0,t.jsx)(s.p,{children:"WriteDACL: Edit ACE's applied to object"}),(0,t.jsx)(s.p,{children:"AllExtendedRights: Change password, reset password, etc."}),(0,t.jsx)(s.p,{children:"ForceChangePassword: Password change for object"}),(0,t.jsx)(s.p,{children:"Self (Self-Membership): Add ourselves to for example a group"}),(0,t.jsxs)(s.p,{children:["(more\u2026)[",(0,t.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/windows/win32/secauthz/access-rights-and-access-masks",children:"https://learn.microsoft.com/en-us/windows/win32/secauthz/access-rights-and-access-masks"}),"]"]})]}),(0,t.jsx)(s.p,{children:"Default Users (so that when enumerating u can note down the non-default users maybe idk)"}),(0,t.jsx)(n,{children:(0,t.jsx)(s.p,{children:"Administrator, Krbtgt, Guest, some super long SID"})}),(0,t.jsx)(s.p,{children:"Other misc stuff idk where to put these"}),(0,t.jsxs)(n,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/system.directoryservices?view=windowsdesktop-9.0",children:"https://learn.microsoft.com/en-us/dotnet/api/system.directoryservices?view=windowsdesktop-9.0"})}),(0,t.jsx)(s.p,{children:"DirectoryEntry\xa0class encapsulates an AD object"}),(0,t.jsx)(n,{children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-powershell",children:"$PDC = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().PdcRoleOwner.Name\r\n$DN = ([adsi]'').distinguishedName\r\n$LDAP = \"LDAP://$PDC/$DN\"\r\n\r\n$direntry = New-Object System.DirectoryServices.DirectoryEntry($LDAP)\n"})})}),(0,t.jsx)(s.p,{children:"DirectorySearcher\xa0class performs queries against AD"}),(0,t.jsx)(n,{children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-powershell",children:'$dirsearcher = New-Object System.DirectoryServices.DirectorySearcher($direntry)\r\n$dirsearcher.filter="samAccountType=805306368" #Users\r\n$dirsearcher.FindAll()\n'})})})]})]}),"\n",(0,t.jsx)(s.h1,{id:"enumeration",children:"Enumeration"}),"\n",(0,t.jsxs)(n,{children:[(0,t.jsx)(s.p,{children:"If can upload stuff"}),(0,t.jsxs)(n,{children:[(0,t.jsx)(s.p,{children:"Upload mimikatz.exe and SharpHound.ps1"}),(0,t.jsx)(s.p,{children:"Bloodhound/sharphound: [WIP]"}),(0,t.jsxs)(s.p,{children:["Mimikatz: ",(0,t.jsx)(s.code,{children:"privilege::debug"})," first, then ",(0,t.jsx)(s.code,{children:"sekurlsa::logonpasswords"})," for NTLM hash, ",(0,t.jsx)(s.code,{children:"sekurlsa::tickets /export"})," for tickets. ",(0,t.jsx)(s.code,{children:"log"})," to save output to file (for easier searching)"]})]})]}),"\n",(0,t.jsx)(s.h1,{id:"exploit-methods",children:"Exploit Methods"}),"\n",(0,t.jsx)(s.h2,{id:"as-rep-roasting",children:"AS-REP Roasting"}),"\n",(0,t.jsxs)(n,{children:[(0,t.jsxs)(s.p,{children:["Abuses: Step 3 of the ",(0,t.jsx)(s.a,{href:"/docs/general/AD#kerberos-auth-steps",children:"Kerberos Auth Steps"})]}),(0,t.jsx)(s.p,{children:"Requires: Known username and password."}),(0,t.jsxs)(s.p,{children:["Run ",(0,t.jsx)(s.code,{children:"impacket-GetNPUsers -dc-ip <domain controller ip> -request -outputfile hashes.asreproast <domain>/<user>"})," (eg ",(0,t.jsx)(s.code,{children:"impacket-GetNPUsers -dc-ip <domain controller ip> -request -outputfile hashes.asreproast corp.com/<user>"}),")"]})]})]})}function l(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},2682:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/NTLMauth-9a448fec46653ba44661a7c711975783.png"},3702:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/KerberosAuth-6790e626e4a45dbfcd584dab1aff8735.png"},8453:(e,s,r)=>{r.d(s,{R:()=>o,x:()=>c});var n=r(6540);const t={},i=n.createContext(t);function o(e){const s=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);